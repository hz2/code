(function(){"use strict";$(document).ready(function(){function t(t){var c,l,a,s,i,e,r,n,p=t,_=p.split("+"),h=0,o=0,u=0,g=[],x=[],f=[]=g=x,d=[],y=[],m=[],v=f,w=0,O=0;for(h in _)if(_.hasOwnProperty(h)){g[h]=_[h].split("-");for(o in g[h])if(g[h].hasOwnProperty(o)){x[h][o]=g[h][o].split("*");for(u in x[h][o])x[h][o].hasOwnProperty(u)&&(f[h][o][u]=x[h][o][u].split("/"))}}for(s in v)if(v.hasOwnProperty(s)){if(1===v[s].length&&1===v[s][0].length&&1===v[s][0][0].length)v[s]=v[s][0][0][0];else{m=v[s];for(a in m)if(m.hasOwnProperty(a)){if(1===m[a].length&&1===m[a][0].length)m[a]=m[a][0][0];else{y=m[a],i=1;for(l in y)if(y.hasOwnProperty(l)){if("0"===y[l][0]&&1===y[l].length)y[l]=0;else if(0!==y[l][0]&&1===y[l].length)y[l]=y[l][0];else{d=y[l],e=d[0]*d[0];for(c in d)if(d.hasOwnProperty(c)){if(c>0&&"0"===d[c])return $("#calc_tip2").text(" 分母不能为零"),$("#calc_tip2").attr("class","error"),$("#calc_result").attr("class","error"),n="无穷";"0"===d[0]?($("#calc_tip2").text(" 分子为零"),$("#calc_tip2").attr("class","warn"),e=0):e/=d[c]}y[l]=parseFloat(e)}i*=y[l]}m[a]=parseFloat(i)}O-=m[a]}r=2*m[0]+parseFloat(O),v[s]=parseFloat(r)}w+=parseFloat(v[s])}return w}var c=0;$("#calc_toggle").text("展开"),$("#calc_his li:gt(4)").css("display","none"),$("#calc").on("input",function(){var l,a=$("#calc").val().split(" ").join("");""===a?($("#calc_tip2").attr("class","").text(""),$("#calc_result").attr("class","").text("归零")):null!==a.match(/[^0-9\+\-\*\/\.]+/g)?($("#calc_tip2").text("输入不正确").attr("class","error"),$("#calc_result").text("错误").attr("class","error")):null!==a.match(/[\-\+\*\/]{2,}/g)?($("#calc_tip2").text("同时输入了多个运算符").attr("class","warn"),$("#calc_result").text("错误").attr("class","error")):null!==a.match(/^[\+\*\/]+/g)?($("#calc_tip2").text("开头不要运算符号").attr("class","warn"),$("#calc_result").text("错误").attr("class","error")):null!==a.match(/\D$/g)?$("#calc_tip2").text(" 请继续输入数字").attr("class","warn"):($("#calc_tip2").text("计算结果").attr("class",""),l=t(a),$("#calc_result").text(l).attr("class",""),$("#calc_his").prepend('<li class="input_his"><span class="myinput_his">'+a+'</span><span class="eq_his">=</span><span class="result_his">'+l+'</span><span class="index_his"># '+(c+=1)+"</span></li>")),$("#calc_his li").length>10&&$("#calc_his li:gt(9)").remove(),$("#calc_his li:has(span)").hover(function(){0===$(".index_his_tip").length&&$(this).append('<span class="index_his_tip">回退</span>')},function(){$(this).children(".index_his_tip").remove()}),"展开"===$("#calc_toggle").text()&&$("#calc_his li:gt(4)").css("display","none"),$("#calc_his li:has(span)").on("click",function(){$("#calc").val($(this).children(".myinput_his").text()),$("#calc_result").text($(this).children(".result_his").text()),$("#calc_tip2").text(""),$("#calc_result,#calc_tip2").attr("class","")})}),$("#calc_clear").on("click",function(){return $("#calc_his li").empty().removeAttr("class"),$("#calc_his li").unbind("click"),$("#calc_his li:has(span)").unbind("hover"),c=0}),$("#calc_reset").on("click",function(){return $("#calc_his li").empty().removeAttr("class"),$("#calc_his li").unbind("click"),$("#calc_his li:has(span)").unbind("hover"),$("#calc_tip2").text(""),$("#calc_result").text("归零"),$("#calc_result,#calc_tip2").attr("class",""),$("#calc").val(""),c=0}),$("#calc_toggle").click(function(){"收起"===$("#calc_toggle").text()?($("#calc_toggle").text("展开"),$("#calc_his li:gt(4)").slideUp(300,"linear")):"展开"===$("#calc_toggle").text()&&($("#calc_toggle").text("收起"),$("#calc_his li:gt(4)").slideDown(300,"linear"))})})})();